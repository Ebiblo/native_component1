{"version":3,"sources":["BottomSheetModal.tsx"],"names":["interpolate","interpolateV1","interpolateNode","interpolateV2","require","BottomSheetModalComponent","content","configs","unmount","ref","initialSnapIndex","_initialSnapIndex","snapPoints","_snapPoints","animatedPositionIndex","_animatedPositionIndex","allowTouchThroughOverlay","DEFAULT_ALLOW_TOUCH_THROUGH_OVERLAY","overlayComponent","OverlayComponent","overlayOpacity","DEFAULT_OVERLAY_OPACITY","dismissOnOverlayPress","DEFAULT_DISMISS_ON_OVERLAY_PRESS","dismissOnScrollDown","DEFAULT_DISMISS_ON_SCROLL_DOWN","onChange","bottomSheetProps","bottomSheetRef","isTemporaryClosing","lastSheetPosition","animatedOverlayOpacity","inputRange","outputRange","extrapolate","Extrapolate","CLAMP","overlayPointerEvents","handleChange","index","current","handleClose","close","handleCollapse","snapTo","collapse","handleSnapTo","handleTemporaryCloseSheet","handleRestoreSheetPosition","handleOverlayPress","expand","temporaryCloseSheet","restoreSheetPosition","onPress","BottomSheetModal","isEqual"],"mappings":"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","sourcesContent":["import React, {\n  forwardRef,\n  memo,\n  useCallback,\n  useEffect,\n  useImperativeHandle,\n  useMemo,\n  useRef,\n} from 'react';\nimport isEqual from 'lodash.isequal';\nimport { useValue } from 'react-native-redash';\nimport Animated, { Extrapolate, set } from 'react-native-reanimated';\nimport BottomSheet from '../bottomSheet';\nimport {\n  DEFAULT_OVERLAY_OPACITY,\n  DEFAULT_DISMISS_ON_OVERLAY_PRESS,\n  DEFAULT_DISMISS_ON_SCROLL_DOWN,\n  DEFAULT_ALLOW_TOUCH_THROUGH_OVERLAY,\n} from './constants';\nimport type { BottomSheetModalType, BottomSheetModalProps } from './types';\n\nconst {\n  interpolate: interpolateV1,\n  interpolateNode: interpolateV2,\n} = require('react-native-reanimated');\nconst interpolate = interpolateV2 || interpolateV1;\n\ntype BottomSheetModal = BottomSheetModalType;\n\nconst BottomSheetModalComponent = forwardRef<\n  BottomSheetModal,\n  BottomSheetModalProps\n>(({ content, configs, unmount }, ref) => {\n  const {\n    initialSnapIndex: _initialSnapIndex = 0,\n    snapPoints: _snapPoints,\n    animatedPositionIndex: _animatedPositionIndex,\n    allowTouchThroughOverlay = DEFAULT_ALLOW_TOUCH_THROUGH_OVERLAY,\n    overlayComponent: OverlayComponent,\n    overlayOpacity = DEFAULT_OVERLAY_OPACITY,\n    dismissOnOverlayPress = DEFAULT_DISMISS_ON_OVERLAY_PRESS,\n    dismissOnScrollDown = DEFAULT_DISMISS_ON_SCROLL_DOWN,\n    onChange,\n    ...bottomSheetProps\n  } = configs;\n\n  //#region refs\n  const bottomSheetRef = useRef<BottomSheet>(null);\n  const isTemporaryClosing = useRef(false);\n  const lastSheetPosition = useRef(0);\n  //#endregion\n\n  //#region variables\n  const animatedPositionIndex = useValue(0);\n  const animatedOverlayOpacity = useMemo(\n    () =>\n      interpolate(animatedPositionIndex, {\n        inputRange: [0, 1],\n        outputRange: [0, overlayOpacity],\n        extrapolate: Extrapolate.CLAMP,\n      }),\n    [animatedPositionIndex, overlayOpacity]\n  );\n  const initialSnapIndex = useMemo(() => (dismissOnScrollDown ? 0 : -1), [\n    dismissOnScrollDown,\n  ]);\n  const snapPoints = useMemo(\n    () => (dismissOnScrollDown ? [0, ..._snapPoints] : _snapPoints),\n    [_snapPoints, dismissOnScrollDown]\n  );\n  const overlayPointerEvents = useMemo(\n    () => (allowTouchThroughOverlay ? 'none' : 'auto'),\n    [allowTouchThroughOverlay]\n  );\n  //#endregion\n\n  //#region callbacks\n  const handleChange = useCallback(\n    index => {\n      if (onChange) {\n        onChange(index);\n      }\n\n      if (!isTemporaryClosing.current) {\n        lastSheetPosition.current = index;\n\n        if (index < (dismissOnScrollDown ? 1 : 0)) {\n          unmount();\n        }\n      }\n    },\n    [unmount, onChange, dismissOnScrollDown]\n  );\n  const handleClose = useCallback(() => {\n    if (isTemporaryClosing.current) {\n      unmount();\n      return;\n    }\n    bottomSheetRef.current?.close();\n  }, [unmount]);\n  const handleCollapse = useCallback(() => {\n    if (dismissOnScrollDown) {\n      bottomSheetRef.current?.snapTo(1);\n    } else {\n      bottomSheetRef.current?.collapse();\n    }\n  }, [dismissOnScrollDown]);\n  const handleSnapTo = useCallback(\n    (index: number) => {\n      bottomSheetRef.current?.snapTo(index + (dismissOnScrollDown ? 1 : 0));\n    },\n    [dismissOnScrollDown]\n  );\n  const handleTemporaryCloseSheet = useCallback(() => {\n    isTemporaryClosing.current = true;\n    bottomSheetRef.current?.close();\n  }, []);\n  const handleRestoreSheetPosition = useCallback(() => {\n    isTemporaryClosing.current = false;\n    bottomSheetRef.current?.snapTo(lastSheetPosition.current);\n  }, []);\n  const handleOverlayPress = useCallback(() => {\n    bottomSheetRef.current?.close();\n  }, []);\n  //#endregion\n\n  //#region effects\n  useImperativeHandle(ref, () => ({\n    close: handleClose,\n    snapTo: handleSnapTo,\n    expand: bottomSheetRef.current!.expand,\n    collapse: handleCollapse,\n    temporaryCloseSheet: handleTemporaryCloseSheet,\n    restoreSheetPosition: handleRestoreSheetPosition,\n  }));\n  useEffect(() => {\n    bottomSheetRef.current?.snapTo(\n      _initialSnapIndex + (dismissOnScrollDown ? 1 : 0)\n    );\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  //#endregion\n\n  // render\n  return (\n    <>\n      {OverlayComponent && (\n        <OverlayComponent\n          animatedOpacity={animatedOverlayOpacity}\n          pointerEvents={overlayPointerEvents}\n          {...(dismissOnOverlayPress ? { onPress: handleOverlayPress } : {})}\n        />\n      )}\n\n      {_animatedPositionIndex && (\n        <Animated.Code\n          exec={set(_animatedPositionIndex, animatedPositionIndex)}\n        />\n      )}\n      <BottomSheet\n        ref={bottomSheetRef}\n        {...bottomSheetProps}\n        initialSnapIndex={initialSnapIndex}\n        snapPoints={snapPoints}\n        animatedPositionIndex={animatedPositionIndex}\n        onChange={handleChange}\n      >\n        {content}\n      </BottomSheet>\n    </>\n  );\n});\n\nconst BottomSheetModal = memo(BottomSheetModalComponent, isEqual);\n\nexport default BottomSheetModal;\n"]}