{"version":3,"sources":["BottomSheetModalContainer.tsx"],"names":["BottomSheetModalContainerComponent","_","ref","sheets","setSheets","currentPresentedSheet","previousPresentedSheet","didHandleRestorePreviousSheet","unmountSheet","uniqueId","current","length","splice","restoreSheetPosition","sheetIndex","indexOf","_sheets","Object","keys","reduce","object","key","handleSnapTo","index","snapTo","handleExpand","expand","handleCollapse","collapse","handlePresent","content","configs","temporaryCloseSheet","state","handleDismiss","close","handleDismissAll","map","present","dismiss","dismissAll","renderSheets","BottomSheetModalContainer","isEqual"],"mappings":";;;;;;;AAAA;;AAWA;;AACA;;;;;;;;AAYA,MAAMA,kCAAkC,gBAAG,uBAGzC,CAACC,CAAD,EAAIC,GAAJ,KAAY;AACZ;AACA,QAAM,CAACC,MAAD,EAASC,SAAT,IAAsB,qBAA0C,EAA1C,CAA5B;AACA,QAAMC,qBAAqB,GAAG,mBAAe,IAAf,CAA9B;AACA,QAAMC,sBAAsB,GAAG,mBAAiB,EAAjB,CAA/B;AACA,QAAMC,6BAA6B,GAAG,mBAAO,KAAP,CAAtC,CALY,CAMZ;AAEA;;AACA,QAAMC,YAAY,GAAG,wBAClBC,QAAD,IAAsB;AACpB;;;AAGA,QAAIA,QAAQ,KAAKJ,qBAAqB,CAACK,OAAvC,EAAgD;AAC9C;;;AAGA,UAAIJ,sBAAsB,CAACI,OAAvB,CAA+BC,MAA/B,KAA0C,CAA9C,EAAiD;AAC/C;AACAN,QAAAA,qBAAqB,CAACK,OAAtB,GAAgC,IAAhC;AACD,OAHD,MAGO,IAAIJ,sBAAsB,CAACI,OAAvB,CAA+BC,MAA/B,GAAwC,CAA5C,EAA+C;AACpD;AACAN,QAAAA,qBAAqB,CAACK,OAAtB,GAAgCJ,sBAAsB,CAACI,OAAvB,CAA+B,CAA/B,CAAhC;AACAJ,QAAAA,sBAAsB,CAACI,OAAvB,CAA+BE,MAA/B,CAAsC,CAAtC,EAAyC,CAAzC;;AAEA,YAAI,CAACL,6BAA6B,CAACG,OAAnC,EAA4C;AAAA;;AAC1C,mCAAAP,MAAM,CACJE,qBAAqB,CAACK,OADlB,CAAN,CAEER,GAFF,CAEMQ,OAFN,gFAEeG,oBAFf;AAGD;;AACDN,QAAAA,6BAA6B,CAACG,OAA9B,GAAwC,KAAxC;AACD;AACF,KAnBD,MAmBO;AACL;;;AAGA,YAAMI,UAAU,GAAGR,sBAAsB,CAACI,OAAvB,CAA+BK,OAA/B,CAAuCN,QAAvC,CAAnB;AACAH,MAAAA,sBAAsB,CAACI,OAAvB,CAA+BE,MAA/B,CAAsCE,UAAtC,EAAkD,CAAlD;AACD;;AAEDV,IAAAA,SAAS,CAACY,OAAO,IACfC,MAAM,CAACC,IAAP,CAAYF,OAAZ,EAAqBG,MAArB,CAA4B,CAACC,MAAD,EAASC,GAAT,KAAiB;AAC3C,UAAIA,GAAG,KAAKZ,QAAZ,EAAsB;AACpBW,QAAAA,MAAM,CAACC,GAAD,CAAN,GAAcL,OAAO,CAACK,GAAD,CAArB;AACD;;AACD,aAAOD,MAAP;AACD,KALD,EAKG,EALH,CADO,CAAT;AAQD,GAxCkB,EAyCnB,CAACjB,MAAD,CAzCmB,CAArB;AA2CA,QAAMmB,YAAY,GAAG,wBACnB,CAACb,QAAD,EAAmBc,KAAnB,KAAqC;AACnC,QAAIpB,MAAM,CAACM,QAAD,CAAV,EAAsB;AAAA;;AACpB,+BAAAN,MAAM,CAACM,QAAD,CAAN,CAAiBP,GAAjB,CAAqBQ,OAArB,gFAA8Bc,MAA9B,CAAqCD,KAArC;AACD;AACF,GALkB,EAMnB,CAACpB,MAAD,CANmB,CAArB;AAQA,QAAMsB,YAAY,GAAG,wBAClBhB,QAAD,IAAsB;AACpB,QAAIN,MAAM,CAACM,QAAD,CAAV,EAAsB;AAAA;;AACpB,gCAAAN,MAAM,CAACM,QAAD,CAAN,CAAiBP,GAAjB,CAAqBQ,OAArB,kFAA8BgB,MAA9B;AACD;AACF,GALkB,EAMnB,CAACvB,MAAD,CANmB,CAArB;AAQA,QAAMwB,cAAc,GAAG,wBACpBlB,QAAD,IAAsB;AACpB,QAAIN,MAAM,CAACM,QAAD,CAAV,EAAsB;AAAA;;AACpB,gCAAAN,MAAM,CAACM,QAAD,CAAN,CAAiBP,GAAjB,CAAqBQ,OAArB,kFAA8BkB,QAA9B;AACD;AACF,GALoB,EAMrB,CAACzB,MAAD,CANqB,CAAvB;AAQA,QAAM0B,aAAa,GAAG,wBACpB,CACEpB,QADF,EAEEqB,OAFF,EAGEC,OAHF,KAIK;AACH,QAAI,CAAC5B,MAAM,CAACM,QAAD,CAAX,EAAuB;AACrB,UAAIJ,qBAAqB,CAACK,OAA1B,EAAmC;AAAA;;AACjC;AACA,kCAAAP,MAAM,CACJE,qBAAqB,CAACK,OADlB,CAAN,CAEER,GAFF,CAEMQ,OAFN,kFAEesB,mBAFf,GAFiC,CAKjC;;AACA1B,QAAAA,sBAAsB,CAACI,OAAvB,GAAiC,CAC/BL,qBAAqB,CAACK,OADS,EAE/B,GAAGJ,sBAAsB,CAACI,OAFK,CAAjC;AAID,OAXoB,CAarB;;;AACAL,MAAAA,qBAAqB,CAACK,OAAtB,GAAgCD,QAAhC;AACAL,MAAAA,SAAS,CAAC6B,KAAK,KAAK,EAClB,GAAGA,KADe;AAElB,SAACxB,QAAD,GAAY;AACVP,UAAAA,GAAG,eAAE,uBADK;AAEV4B,UAAAA,OAFU;AAGVC,UAAAA;AAHU;AAFM,OAAL,CAAN,CAAT;AAQD;AACF,GA9BmB,EA+BpB,CAAC5B,MAAD,CA/BoB,CAAtB;AAiCA,QAAM+B,aAAa,GAAG,wBACnBzB,QAAD,IAAsB;AACpB,QAAIN,MAAM,CAACM,QAAD,CAAV,EAAsB;AAAA;;AACpB,gCAAAN,MAAM,CAACM,QAAD,CAAN,CAAiBP,GAAjB,CAAqBQ,OAArB,kFAA8ByB,KAA9B;AAEA;;;;AAGA,UACE1B,QAAQ,KAAKJ,qBAAqB,CAACK,OAAnC,IACAJ,sBAAsB,CAACI,OAAvB,CAA+BC,MAA/B,GAAwC,CAF1C,EAGE;AAAA;;AACAJ,QAAAA,6BAA6B,CAACG,OAA9B,GAAwC,IAAxC;AACA,iCAAAP,MAAM,CACJG,sBAAsB,CAACI,OAAvB,CAA+B,CAA/B,CADI,CAAN,CAEER,GAFF,CAEMQ,OAFN,gFAEeG,oBAFf;AAGD;AACF;AACF,GAlBmB,EAmBpB,CAACV,MAAD,CAnBoB,CAAtB;AAqBA,QAAMiC,gBAAgB,GAAG,wBAAY,MAAM;AACzCnB,IAAAA,MAAM,CAACC,IAAP,CAAYf,MAAZ,EAAoBkC,GAApB,CAAwBhB,GAAG,IAAI;AAC7BlB,MAAAA,MAAM,CAACkB,GAAD,CAAN,CAAYnB,GAAZ,CAAgBQ,OAAhB,CAAyByB,KAAzB;AACD,KAFD;AAGD,GAJwB,EAItB,CAAChC,MAAD,CAJsB,CAAzB,CAlIY,CAuIZ;;AAEA,kCAAoBD,GAApB,EAAyB,OAAO;AAC9BoC,IAAAA,OAAO,EAAET,aADqB;AAE9BU,IAAAA,OAAO,EAAEL,aAFqB;AAG9BM,IAAAA,UAAU,EAAEJ,gBAHkB;AAI9BZ,IAAAA,MAAM,EAAEF,YAJsB;AAK9BI,IAAAA,MAAM,EAAED,YALsB;AAM9BG,IAAAA,QAAQ,EAAED;AANoB,GAAP,CAAzB,EAzIY,CAkJZ;;AACA,QAAMc,YAAY,GAAG,wBAAY,MAAM;AACrC,WAAOxB,MAAM,CAACC,IAAP,CAAYf,MAAZ,EAAoBkC,GAApB,CAAwBhB,GAAG,iBAChC,6BAAC,yBAAD;AACE,MAAA,GAAG,EAAEA,GADP;AAEE,MAAA,GAAG,EAAElB,MAAM,CAACkB,GAAD,CAAN,CAAYnB,GAFnB;AAGE,MAAA,OAAO,EAAEC,MAAM,CAACkB,GAAD,CAAN,CAAYS,OAHvB;AAIE,MAAA,OAAO,EAAE3B,MAAM,CAACkB,GAAD,CAAN,CAAYU,OAJvB;AAKE,MAAA,OAAO,EAAE,MAAMvB,YAAY,CAACa,GAAD;AAL7B,MADK,CAAP;AASD,GAVoB,EAUlB,CAAClB,MAAD,EAASK,YAAT,CAVkB,CAArB;AAWA,sBAAO,4DAAGiC,YAAY,EAAf,CAAP,CA9JY,CA+JZ;AACD,CAnK0C,CAA3C;AAqKA,MAAMC,yBAAyB,gBAAG,iBAChC1C,kCADgC,EAEhC2C,eAFgC,CAAlC;eAKeD,yB","sourcesContent":["import React, {\n  useCallback,\n  useImperativeHandle,\n  useState,\n  useRef,\n  forwardRef,\n  ReactNode,\n  createRef,\n  RefObject,\n  memo,\n} from 'react';\nimport isEqual from 'lodash.isequal';\nimport BottomSheetModal from '../bottomSheetModal';\nimport type { BottomSheetModalConfigs } from '../../types';\nimport type { BottomSheetModalContextType } from '../../contexts/modal';\n\ntype BottomSheetModalContainer = BottomSheetModalContextType;\n\ntype BottomSheetItem = {\n  ref: RefObject<BottomSheetModal>;\n  content: ReactNode;\n  configs: BottomSheetModalConfigs;\n};\n\nconst BottomSheetModalContainerComponent = forwardRef<\n  BottomSheetModalContainer,\n  {}\n>((_, ref) => {\n  //#region state\n  const [sheets, setSheets] = useState<Record<string, BottomSheetItem>>({});\n  const currentPresentedSheet = useRef<string>(null);\n  const previousPresentedSheet = useRef<string[]>([]);\n  const didHandleRestorePreviousSheet = useRef(false);\n  //#endregion\n\n  //#region methods\n  const unmountSheet = useCallback(\n    (uniqueId: string) => {\n      /**\n       * dismissing the current sheet\n       */\n      if (uniqueId === currentPresentedSheet.current) {\n        /**\n         * no previous sheets presented.\n         */\n        if (previousPresentedSheet.current.length === 0) {\n          // @ts-ignore\n          currentPresentedSheet.current = null;\n        } else if (previousPresentedSheet.current.length > 0) {\n          // @ts-ignore\n          currentPresentedSheet.current = previousPresentedSheet.current[0];\n          previousPresentedSheet.current.splice(0, 1);\n\n          if (!didHandleRestorePreviousSheet.current) {\n            sheets[\n              currentPresentedSheet.current\n            ].ref.current?.restoreSheetPosition();\n          }\n          didHandleRestorePreviousSheet.current = false;\n        }\n      } else {\n        /**\n         * dismissing a sheet in the background.\n         */\n        const sheetIndex = previousPresentedSheet.current.indexOf(uniqueId);\n        previousPresentedSheet.current.splice(sheetIndex, 1);\n      }\n\n      setSheets(_sheets =>\n        Object.keys(_sheets).reduce((object, key) => {\n          if (key !== uniqueId) {\n            object[key] = _sheets[key];\n          }\n          return object;\n        }, {} as Record<string, BottomSheetItem>)\n      );\n    },\n    [sheets]\n  );\n  const handleSnapTo = useCallback(\n    (uniqueId: string, index: number) => {\n      if (sheets[uniqueId]) {\n        sheets[uniqueId].ref.current?.snapTo(index);\n      }\n    },\n    [sheets]\n  );\n  const handleExpand = useCallback(\n    (uniqueId: string) => {\n      if (sheets[uniqueId]) {\n        sheets[uniqueId].ref.current?.expand();\n      }\n    },\n    [sheets]\n  );\n  const handleCollapse = useCallback(\n    (uniqueId: string) => {\n      if (sheets[uniqueId]) {\n        sheets[uniqueId].ref.current?.collapse();\n      }\n    },\n    [sheets]\n  );\n  const handlePresent = useCallback(\n    (\n      uniqueId: string,\n      content: ReactNode,\n      configs: BottomSheetModalConfigs\n    ) => {\n      if (!sheets[uniqueId]) {\n        if (currentPresentedSheet.current) {\n          // collapse current sheet\n          sheets[\n            currentPresentedSheet.current\n          ].ref.current?.temporaryCloseSheet();\n          // @ts-ignore\n          previousPresentedSheet.current = [\n            currentPresentedSheet.current,\n            ...previousPresentedSheet.current,\n          ];\n        }\n\n        // @ts-ignore\n        currentPresentedSheet.current = uniqueId;\n        setSheets(state => ({\n          ...state,\n          [uniqueId]: {\n            ref: createRef(),\n            content,\n            configs,\n          },\n        }));\n      }\n    },\n    [sheets]\n  );\n  const handleDismiss = useCallback(\n    (uniqueId: string) => {\n      if (sheets[uniqueId]) {\n        sheets[uniqueId].ref.current?.close();\n\n        /**\n         * dismissing the current sheet\n         */\n        if (\n          uniqueId === currentPresentedSheet.current &&\n          previousPresentedSheet.current.length > 0\n        ) {\n          didHandleRestorePreviousSheet.current = true;\n          sheets[\n            previousPresentedSheet.current[0]\n          ].ref.current?.restoreSheetPosition();\n        }\n      }\n    },\n    [sheets]\n  );\n  const handleDismissAll = useCallback(() => {\n    Object.keys(sheets).map(key => {\n      sheets[key].ref.current!.close();\n    });\n  }, [sheets]);\n  //#endregion\n\n  useImperativeHandle(ref, () => ({\n    present: handlePresent,\n    dismiss: handleDismiss,\n    dismissAll: handleDismissAll,\n    snapTo: handleSnapTo,\n    expand: handleExpand,\n    collapse: handleCollapse,\n  }));\n\n  //#region renders\n  const renderSheets = useCallback(() => {\n    return Object.keys(sheets).map(key => (\n      <BottomSheetModal\n        key={key}\n        ref={sheets[key].ref}\n        content={sheets[key].content}\n        configs={sheets[key].configs}\n        unmount={() => unmountSheet(key)}\n      />\n    ));\n  }, [sheets, unmountSheet]);\n  return <>{renderSheets()}</>;\n  //#endregion\n});\n\nconst BottomSheetModalContainer = memo(\n  BottomSheetModalContainerComponent,\n  isEqual\n);\n\nexport default BottomSheetModalContainer;\n"]}