{"version":3,"sources":["BottomSheetModal.tsx"],"names":["React","forwardRef","memo","useCallback","useEffect","useImperativeHandle","useMemo","useRef","isEqual","useValue","Animated","Extrapolate","set","BottomSheet","DEFAULT_OVERLAY_OPACITY","DEFAULT_DISMISS_ON_OVERLAY_PRESS","DEFAULT_DISMISS_ON_SCROLL_DOWN","DEFAULT_ALLOW_TOUCH_THROUGH_OVERLAY","interpolate","interpolateV1","interpolateNode","interpolateV2","require","BottomSheetModalComponent","content","configs","unmount","ref","initialSnapIndex","_initialSnapIndex","snapPoints","_snapPoints","animatedPositionIndex","_animatedPositionIndex","allowTouchThroughOverlay","overlayComponent","OverlayComponent","overlayOpacity","dismissOnOverlayPress","dismissOnScrollDown","onChange","bottomSheetProps","bottomSheetRef","isTemporaryClosing","lastSheetPosition","animatedOverlayOpacity","inputRange","outputRange","extrapolate","CLAMP","overlayPointerEvents","handleChange","index","current","handleClose","close","handleCollapse","snapTo","collapse","handleSnapTo","handleTemporaryCloseSheet","handleRestoreSheetPosition","handleOverlayPress","expand","temporaryCloseSheet","restoreSheetPosition","onPress","BottomSheetModal"],"mappings":"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","sourcesContent":["import React, {\n  forwardRef,\n  memo,\n  useCallback,\n  useEffect,\n  useImperativeHandle,\n  useMemo,\n  useRef,\n} from 'react';\nimport isEqual from 'lodash.isequal';\nimport { useValue } from 'react-native-redash';\nimport Animated, { Extrapolate, set } from 'react-native-reanimated';\nimport BottomSheet from '../bottomSheet';\nimport {\n  DEFAULT_OVERLAY_OPACITY,\n  DEFAULT_DISMISS_ON_OVERLAY_PRESS,\n  DEFAULT_DISMISS_ON_SCROLL_DOWN,\n  DEFAULT_ALLOW_TOUCH_THROUGH_OVERLAY,\n} from './constants';\nimport type { BottomSheetModalType, BottomSheetModalProps } from './types';\n\nconst {\n  interpolate: interpolateV1,\n  interpolateNode: interpolateV2,\n} = require('react-native-reanimated');\nconst interpolate = interpolateV2 || interpolateV1;\n\ntype BottomSheetModal = BottomSheetModalType;\n\nconst BottomSheetModalComponent = forwardRef<\n  BottomSheetModal,\n  BottomSheetModalProps\n>(({ content, configs, unmount }, ref) => {\n  const {\n    initialSnapIndex: _initialSnapIndex = 0,\n    snapPoints: _snapPoints,\n    animatedPositionIndex: _animatedPositionIndex,\n    allowTouchThroughOverlay = DEFAULT_ALLOW_TOUCH_THROUGH_OVERLAY,\n    overlayComponent: OverlayComponent,\n    overlayOpacity = DEFAULT_OVERLAY_OPACITY,\n    dismissOnOverlayPress = DEFAULT_DISMISS_ON_OVERLAY_PRESS,\n    dismissOnScrollDown = DEFAULT_DISMISS_ON_SCROLL_DOWN,\n    onChange,\n    ...bottomSheetProps\n  } = configs;\n\n  //#region refs\n  const bottomSheetRef = useRef<BottomSheet>(null);\n  const isTemporaryClosing = useRef(false);\n  const lastSheetPosition = useRef(0);\n  //#endregion\n\n  //#region variables\n  const animatedPositionIndex = useValue(0);\n  const animatedOverlayOpacity = useMemo(\n    () =>\n      interpolate(animatedPositionIndex, {\n        inputRange: [0, 1],\n        outputRange: [0, overlayOpacity],\n        extrapolate: Extrapolate.CLAMP,\n      }),\n    [animatedPositionIndex, overlayOpacity]\n  );\n  const initialSnapIndex = useMemo(() => (dismissOnScrollDown ? 0 : -1), [\n    dismissOnScrollDown,\n  ]);\n  const snapPoints = useMemo(\n    () => (dismissOnScrollDown ? [0, ..._snapPoints] : _snapPoints),\n    [_snapPoints, dismissOnScrollDown]\n  );\n  const overlayPointerEvents = useMemo(\n    () => (allowTouchThroughOverlay ? 'none' : 'auto'),\n    [allowTouchThroughOverlay]\n  );\n  //#endregion\n\n  //#region callbacks\n  const handleChange = useCallback(\n    index => {\n      if (onChange) {\n        onChange(index);\n      }\n\n      if (!isTemporaryClosing.current) {\n        lastSheetPosition.current = index;\n\n        if (index < (dismissOnScrollDown ? 1 : 0)) {\n          unmount();\n        }\n      }\n    },\n    [unmount, onChange, dismissOnScrollDown]\n  );\n  const handleClose = useCallback(() => {\n    if (isTemporaryClosing.current) {\n      unmount();\n      return;\n    }\n    bottomSheetRef.current?.close();\n  }, [unmount]);\n  const handleCollapse = useCallback(() => {\n    if (dismissOnScrollDown) {\n      bottomSheetRef.current?.snapTo(1);\n    } else {\n      bottomSheetRef.current?.collapse();\n    }\n  }, [dismissOnScrollDown]);\n  const handleSnapTo = useCallback(\n    (index: number) => {\n      bottomSheetRef.current?.snapTo(index + (dismissOnScrollDown ? 1 : 0));\n    },\n    [dismissOnScrollDown]\n  );\n  const handleTemporaryCloseSheet = useCallback(() => {\n    isTemporaryClosing.current = true;\n    bottomSheetRef.current?.close();\n  }, []);\n  const handleRestoreSheetPosition = useCallback(() => {\n    isTemporaryClosing.current = false;\n    bottomSheetRef.current?.snapTo(lastSheetPosition.current);\n  }, []);\n  const handleOverlayPress = useCallback(() => {\n    bottomSheetRef.current?.close();\n  }, []);\n  //#endregion\n\n  //#region effects\n  useImperativeHandle(ref, () => ({\n    close: handleClose,\n    snapTo: handleSnapTo,\n    expand: bottomSheetRef.current!.expand,\n    collapse: handleCollapse,\n    temporaryCloseSheet: handleTemporaryCloseSheet,\n    restoreSheetPosition: handleRestoreSheetPosition,\n  }));\n  useEffect(() => {\n    bottomSheetRef.current?.snapTo(\n      _initialSnapIndex + (dismissOnScrollDown ? 1 : 0)\n    );\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  //#endregion\n\n  // render\n  return (\n    <>\n      {OverlayComponent && (\n        <OverlayComponent\n          animatedOpacity={animatedOverlayOpacity}\n          pointerEvents={overlayPointerEvents}\n          {...(dismissOnOverlayPress ? { onPress: handleOverlayPress } : {})}\n        />\n      )}\n\n      {_animatedPositionIndex && (\n        <Animated.Code\n          exec={set(_animatedPositionIndex, animatedPositionIndex)}\n        />\n      )}\n      <BottomSheet\n        ref={bottomSheetRef}\n        {...bottomSheetProps}\n        initialSnapIndex={initialSnapIndex}\n        snapPoints={snapPoints}\n        animatedPositionIndex={animatedPositionIndex}\n        onChange={handleChange}\n      >\n        {content}\n      </BottomSheet>\n    </>\n  );\n});\n\nconst BottomSheetModal = memo(BottomSheetModalComponent, isEqual);\n\nexport default BottomSheetModal;\n"]}